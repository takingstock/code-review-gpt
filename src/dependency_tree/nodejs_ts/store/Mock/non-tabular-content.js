const DEFAULT_NON_TABLAR_CONTENT = [
    {
        "confidence_score": 0,
        "global_key": "Vendor ID",
        "data_type": "alphanumeric",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 1,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "NO_VENDOR",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Vendor Name",
        "data_type": "string",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 2,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "NO_VENDOR",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Vendor Address",
        "data_type": "alphanumeric",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 3,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "NO_VENDOR",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Purchase Order Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 4,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Job Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 5,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Invoice Number",
        "data_type": "alphanumeric",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 6,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Invoice Date",
        "data_type": "date",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 7,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Invoice Sub Total",
        "data_type": "number",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 8,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Total Tax Amount",
        "data_type": "number",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 9,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Invoice Freight",
        "data_type": "number",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 10,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Total Invoice Amount",
        "data_type": "number",
        "mandatory": true,
        "recon": null,
        "qc_error_type": null,
        "order": 11,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Account Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 12,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": "",
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Purchase Order Date",
        "data_type": "date",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 13,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Loan Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 14,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Sub Contract Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 15,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Vendor Registration Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 16,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Customer Number",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 17,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    },
    {
        "confidence_score": 0,
        "global_key": "Payment Terms",
        "data_type": "alphanumeric",
        "mandatory": false,
        "recon": null,
        "qc_error_type": null,
        "order": 18,
        "local_key": {
            "edited_key": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        },
        "local_value": {
            "edited_value": null,
            "text": "",
            "pts": [],
            "polarised_pts": [],
            "ocr_pts": []
        }
    }
]

const { auto } = require("async");
const {
    globalMappingService
} = require('../Services');

const STATIC_INVOICE = "Invoices Custom"
const GENERATE_DEFAULT_CONTENT = (data, callback) => {
    const { documentType, tenantId } = { ...data }
    const defaultResponse = { tabularContent: [], nonTabularContent: [] }
    console.log("GENERATE_DEFAULT_CONTENT payload", data)
    if (documentType === STATIC_INVOICE) {
        return callback(null, { tabularContent: [], nonTabularContent: DEFAULT_NON_TABLAR_CONTENT })
    }
    if (documentType === "#NEW_FORMAT#") {
        return callback(null, defaultResponse)
    }
    console.log("GENERATE_DEFAULT_CONTENT Starts....")
    auto({
        globalMapping: (cb) => {
            globalMappingService.findOne({ tenantId, documentType }, {}, null, null, cb)
        },
        preparedContent: ['globalMapping', ({ globalMapping }, cb) => {
            if (!globalMapping || !globalMapping.mapping) {
                return cb(null, defaultResponse)
            }
            const defaultKey = {
                "confidence_score": 0,
                "global_key": "",
                "data_type": "",
                "mandatory": false,
                "recon": null,
                "qc_error_type": null,
                "order": 0,
                "local_key": {
                    "edited_key": null,
                    "text": "",
                    "pts": [],
                    "polarised_pts": [],
                    "ocr_pts": []
                },
                "local_value": {
                    "edited_value": null,
                    "text": "",
                    "pts": [],
                    "polarised_pts": [],
                    "ocr_pts": []
                }
            }
            const nonTabularContent = []
            globalMapping.mapping.forEach((e, i) => {
                const keyData = { ...defaultKey }
                keyData['global_key'] = e.key
                keyData['data_type'] = e.dataType
                keyData['mandatory'] = e.isRequired
                keyData['order'] = i + 1
                if (e.global_key === 'Vendor ID' || e.global_key === 'Vendor Name' || e.global_key === 'Vendor Address') {
                    keyData["local_value"]["text"] = "NO_VENDOR"
                }
                nonTabularContent.push(keyData)
            })
            return cb(null, { nonTabularContent, tabularContent: [] })
        }]
    }, (e, { preparedContent }) => {
        if (e) {
            return callback(null, defaultResponse)
        }
        console.log("GENERATE_DEFAULT_CONTENT payload preparedContent", JSON.stringify(preparedContent))
        console.log("GENERATE_DEFAULT_CONTENT payload defaultResponse", defaultResponse)

        callback(null, preparedContent || defaultResponse)
    })
}
module.exports.DEFAULT_CONTENT = GENERATE_DEFAULT_CONTENT
